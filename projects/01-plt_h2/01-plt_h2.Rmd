---
title: "Complete h2 results on platelets in GAIT 2 Study"
author: "Miquel VÃ zquez-Santiago"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: united
    toc: true
    keep_md: true
---

```{r options, echo = F}
opts_chunk$set(fig.path = "figures/",
							 comment = NA,
							 tidy = F,
							 message = F,
							 warning = F,
							 echo = F,
							 results = 'verbatim')



```{r par}
alpha <- 0.05
```

# Library

```{r inc, cache = F}
library(knitr)
library(rmarkdown)

library(plyr)

library(ggplot2)
library(gridExtra)
library(lattice)
library(RColorBrewer)

library(solarius)

library(tidyr)
library(broom)
library(pander)
```

```{r settings, cahe = F}
theme_set(theme_light())
panderOptions('table.split.table', Inf)
panderOptions('knitr.auto.asis', FALSE)
```

# Load data

```{r data, cache = F, echo = T}
dat <- thesis.phen.platelets (group = "platelets")

# vector of variables
vars <- sort(names(dat)[27:41])
	
	# numerical
	dat[, vars] <- lapply(dat[, vars], as.numeric)

# data.frame of vars
plt <- dat[, c(27:41)]
```
# Distribution

```{r plots, cahe = F, echo = T}
# bucle
for(i in seq_along(vars)){
	
	# plots
	dens <- thesis.plot.dens(dat, vars)	
	qq <- thesis.plot.qq(dat, vars)
}

# arrenge
dens_p <- marrangeGrob(dens, nrow = 3, ncol = 5)
qq_p <- marrangeGrob(qq, nrow = 3, ncol = 5)

# return
dens_p
qq_p

# ggsave
ggsave(dens_p, file = "gg_dens.png")
ggsave(qq_p, file = "gg_qq.png")
```				

# Descriptive
```{r summary, results = "asis", cache = F}
# function
for (i in 1:ncol(plt)){
	var <- colnames(plt)[i]

	# summary	
	summ <- summary(dat[, var])
	
	#pander
  cat("###", var, "\n") 
  pander(summ, style = "rmarkdown", digits = 3, big.mark = ",")
}
```

# Heredability

```{r models_h2, results = "asis", cache = T}
# variables & list
vars <- thesis.traits.platelets()
models <- list()

# bucle
for(i in vars){
	cat("###", i, "\n") 
	
	covlist <- thesis.covlist_plt.h2(i)
	trans <- thesis.trans_plt.h2(i)

	mods <- thesis.models.h2(dat, i, covlist, trans)

models[[length(models) + 1]] = mods
}

# list to data.frame
tab <- ldply (models, data.frame)

tab <- mutate(tab,
				lower.SE = (Var - SE),
				upper.SE = (Var + SE))

tab_mod <- as.data.frame(tab[order(-tab$Var), ])

# pander
pander(tab_mod, style = "rmarkdown", digits = 3, big.mark = ",")
```

# Plotting h2
```{r plot_h2, cahe = F, echo = T}
# fix sort
tab_mod$trait <- factor(tab_mod$trait, levels = tab_mod$trait[order(tab_mod$Var)])

# plot
h2_p <- ggplot(tab_mod, aes(x = trait, y = Var)) + 
                        geom_point(aes(trait)) +
												geom_pointrange(aes(ymin = lower.SE, ymax = upper.SE)) +
                        coord_flip()


h2_classic <- ggplot(tab_mod, aes(x = trait, y = Var)) + 
							 			geom_bar(position = 'dodge', stat = 'identity') +
							 			geom_errorbar(aes(ymin = lower.SE, ymax = upper.SE), width =.2, position = "identity") +
							 			coord_flip()

# return
h2_p

# ggsave
ggsave(h2_p, file = "gg_h2.png")
ggsave(h2_classic, file = "gg_h2_c.png")
```
											   
